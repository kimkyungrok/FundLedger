<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title><%= typeof title !== 'undefined' ? title : 'App' %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    rel="stylesheet">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container d-flex justify-content-between align-items-center">
      <a class="navbar-brand" href="/entries">공금 회계 목록</a>

      <!-- 엑셀 내보내기 버튼 -->
      <button id="excelExportBtn" type="button" class="btn btn-success btn-sm">
        <i class="bi bi-file-earmark-excel me-1"></i> 엑셀 내보내기
      </button>
    </div>
  </nav>

  <div class="container my-4">
    <%- body %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 현재 URL의 검색 파라미터를 그대로 전달하여 내보내기
    (function(){
      const btn = document.getElementById('excelExportBtn');
      if (!btn) return;
      btn.addEventListener('click', async () => {
        const url = '/entries/export' + (window.location.search || '');
        // 스트리밍 다운로드
        const res = await fetch(url);
        if (!res.ok) { alert('엑셀 내보내기 실패'); return; }
        const blob = await res.blob();
        const a = document.createElement('a');
        const objUrl = URL.createObjectURL(blob);
        a.href = objUrl;
        a.download = '입출금내역.xlsx';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(objUrl);
      });
    })();
  </script>
</body>
</html>
